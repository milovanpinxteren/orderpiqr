{% extends "registration/base_auth.html" %}
{% load static i18n %}

{% block title %}{% trans "Enter Your Name" %} - OrderPiqR{% endblock %}

{% block content %}
<div class="auth-card">
    <div class="auth-header">
        <img src="{% static 'orderpiqrApp/img/favicon.png' %}" alt="OrderPiqR" class="auth-logo">
        <h1 class="auth-title">{% trans "Welcome!" %}</h1>
        <p class="auth-subtitle">{% trans "Please enter your name to register this device" %}</p>
    </div>

    <div class="auth-body">
        <form id="name-form" method="POST">
            {% csrf_token %}

            <div class="form-group">
                <label class="form-label required" for="name">{% trans "Your Name" %}</label>
                <input type="text"
                       class="form-control"
                       id="name"
                       name="name"
                       placeholder="{% trans 'Enter your name' %}"
                       autofocus
                       required>
                <span class="form-hint">{% trans "This name will be shown when you pick orders" %}</span>
            </div>

            <div style="margin-top: 24px;">
                <button type="submit" class="btn btn-primary">
                    {% trans "Continue" %}
                </button>
            </div>
        </form>
    </div>

    <div class="auth-footer">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 6px;">
            <rect x="5" y="2" width="14" height="20" rx="2"/>
            <path d="M12 18h.01"/>
        </svg>
        {% trans "This device will be registered for order picking" %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script type="text/javascript">
    (function() {
        const STORAGE_KEY = 'orderpiqr_device_id';
        let deviceId = localStorage.getItem(STORAGE_KEY);
        if (!deviceId) {
            deviceId = (typeof crypto !== 'undefined' && crypto.randomUUID)
                ? crypto.randomUUID()
                : 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                    const r = Math.random() * 16 | 0;
                    const v = c === 'x' ? r : (r & 0x3 | 0x8);
                    return v.toString(16);
                });
            localStorage.setItem(STORAGE_KEY, deviceId);
        }
        const form = document.getElementById('name-form');
        const fingerprintInput = document.createElement('input');
        fingerprintInput.type = 'hidden';
        fingerprintInput.name = 'device_fingerprint';
        fingerprintInput.value = deviceId;
        form.appendChild(fingerprintInput);
    })();
</script>
{% endblock %}
