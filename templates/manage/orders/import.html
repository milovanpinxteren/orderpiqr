{% extends "manage/base.html" %}
{% load static i18n %}

{% block title %}{% trans "Import Orders" %}{% endblock %}
{% block page_title %}{% trans "Import Orders" %}{% endblock %}
{% block page_subtitle %}<p class="page-subtitle">{% trans "Upload a CSV file to import orders" %}</p>{% endblock %}

{% block content %}
<div class="import-container">
    <div class="card">
        <div class="card-header">
            <h3>{% trans "Upload CSV File" %}</h3>
        </div>
        <div class="card-body">
            <form method="post" enctype="multipart/form-data" id="import-form">
                {% csrf_token %}
                <div class="form-group">
                    <label class="form-label required">{% trans "Select CSV File" %}</label>
                    <div class="file-upload-area" id="file-upload-area">
                        <input type="file" name="csv_file" id="csv-file" accept=".csv" required>
                        <div class="file-upload-content">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                                <polyline points="17 8 12 3 7 8"/>
                                <line x1="12" y1="3" x2="12" y2="15"/>
                            </svg>
                            <p class="upload-text">{% trans "Drag and drop your CSV file here, or click to select" %}</p>
                            <p class="upload-hint" id="file-name">{% trans "Maximum file size: 5MB" %}</p>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <a href="{% url 'manage_orders' %}" class="btn btn-secondary">{% trans "Cancel" %}</a>
                    <button type="submit" class="btn btn-primary" id="import-btn" disabled>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4m14-7l-5-5-5 5m5-5v12"/>
                        </svg>
                        {% trans "Import Orders" %}
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="card mt-lg">
        <div class="card-header">
            <h3>{% trans "CSV Format" %}</h3>
        </div>
        <div class="card-body">
            <p>{% trans "Your CSV file should have the following columns:" %}</p>

            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>{% trans "Column" %}</th>
                            <th>{% trans "Required" %}</th>
                            <th>{% trans "Description" %}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>order_code</code></td>
                            <td><span class="badge badge-success">{% trans "Yes" %}</span></td>
                            <td>{% trans "Unique order identifier" %}</td>
                        </tr>
                        <tr>
                            <td><code>product_code</code></td>
                            <td><span class="badge badge-success">{% trans "Yes" %}</span></td>
                            <td>{% trans "Product code (must exist in your inventory)" %}</td>
                        </tr>
                        <tr>
                            <td><code>amount</code></td>
                            <td><span class="badge badge-secondary">{% trans "No" %}</span></td>
                            <td>{% trans "Quantity (default: 1)" %}</td>
                        </tr>
                        <tr>
                            <td><code>notes</code></td>
                            <td><span class="badge badge-secondary">{% trans "No" %}</span></td>
                            <td>{% trans "Order notes (only from first line)" %}</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h4 class="mt-md">{% trans "Example CSV" %}</h4>
            <pre class="code-block">order_code,product_code,amount,notes
ORD-001,SKU-001,2,Priority order
ORD-001,SKU-002,1,
ORD-002,SKU-003,3,
ORD-002,SKU-001,1,</pre>

            <div class="info-box mt-md">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M12 16v-4m0-4h.01"/>
                </svg>
                <div>
                    <strong>{% trans "Notes" %}:</strong>
                    <ul class="info-list">
                        <li>{% trans "Multiple rows with the same order_code will be combined into one order" %}</li>
                        <li>{% trans "Product codes must already exist in your inventory" %}</li>
                        <li>{% trans "Orders with duplicate codes will be skipped" %}</li>
                        <li>{% trans "Imported orders will have 'draft' status" %}</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.import-container {
    max-width: 800px;
}

.file-upload-area {
    border: 2px dashed var(--border-color);
    border-radius: var(--border-radius-lg);
    padding: var(--spacing-xl);
    text-align: center;
    cursor: pointer;
    transition: all var(--transition-fast);
    position: relative;
}

.file-upload-area:hover,
.file-upload-area.dragover {
    border-color: var(--primary);
    background: var(--primary-light);
}

.file-upload-area input[type="file"] {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    cursor: pointer;
}

.file-upload-content svg {
    color: var(--gray-400);
    margin-bottom: var(--spacing-md);
}

.upload-text {
    font-weight: 500;
    color: var(--text-primary);
    margin: 0 0 var(--spacing-xs);
}

.upload-hint {
    font-size: 0.8125rem;
    color: var(--text-muted);
    margin: 0;
}

.file-upload-area.has-file {
    border-color: var(--success);
    background: var(--success-light);
}

.file-upload-area.has-file .file-upload-content svg {
    color: var(--success);
}

.code-block {
    background: var(--gray-800);
    color: var(--gray-100);
    padding: var(--spacing-md);
    border-radius: var(--border-radius);
    font-family: 'Courier New', monospace;
    font-size: 0.8125rem;
    overflow-x: auto;
    margin: 0;
}

.info-box {
    display: flex;
    gap: var(--spacing-sm);
    padding: var(--spacing-md);
    background: var(--info-light);
    border-radius: var(--border-radius);
    color: #0c5460;
}

.info-box svg {
    flex-shrink: 0;
    margin-top: 2px;
}

.info-list {
    margin: var(--spacing-xs) 0 0;
    padding-left: var(--spacing-md);
}

.info-list li {
    margin-bottom: var(--spacing-xs);
}

.info-list li:last-child {
    margin-bottom: 0;
}

.form-actions {
    display: flex;
    gap: var(--spacing-sm);
    justify-content: flex-end;
    margin-top: var(--spacing-lg);
}

h4 {
    font-size: 1rem;
    margin: 0;
}
</style>

<script>
const fileInput = document.getElementById('csv-file');
const uploadArea = document.getElementById('file-upload-area');
const fileName = document.getElementById('file-name');
const importBtn = document.getElementById('import-btn');

// File selection
fileInput.addEventListener('change', function() {
    if (this.files.length > 0) {
        const file = this.files[0];
        fileName.textContent = file.name;
        uploadArea.classList.add('has-file');
        importBtn.disabled = false;
    } else {
        fileName.textContent = '{% trans "Maximum file size: 5MB" %}';
        uploadArea.classList.remove('has-file');
        importBtn.disabled = true;
    }
});

// Drag and drop
uploadArea.addEventListener('dragover', function(e) {
    e.preventDefault();
    this.classList.add('dragover');
});

uploadArea.addEventListener('dragleave', function(e) {
    e.preventDefault();
    this.classList.remove('dragover');
});

uploadArea.addEventListener('drop', function(e) {
    e.preventDefault();
    this.classList.remove('dragover');

    if (e.dataTransfer.files.length > 0) {
        fileInput.files = e.dataTransfer.files;
        const event = new Event('change');
        fileInput.dispatchEvent(event);
    }
});
</script>
{% endblock %}
